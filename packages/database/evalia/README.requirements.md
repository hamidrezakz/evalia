# Evalia Assessment Platform: Requirements & Architecture

## Vision

یک پلتفرم ارزیابی سازمانی چندسازمانی (multi-tenant) که سازمان‌ها بتوانند اعضای خود را برای دوره‌های ارزیابی ثبت‌نام کنند، آزمون‌های شخصیتی و تیمی (self/observer) برگزار کنند، داده‌ها را تحلیل (AI/آماری) و نتایج را در پنل‌های نقش‌محور (عضو، مدیر، مدیرعامل، تسهیل‌گر، مدیر ارزیابی) نمایش دهند.

---

## 1. نقش‌ها و دسترسی‌ها

- **عضو (Member):** شرکت‌کننده آزمون، مشاهده نتایج شخصی و داشبورد شخصی
- **تسهیل‌گر (Facilitator):** مشاهده و ثبت ارزیابی برای اعضا (observer)، داشبورد ویژه تسهیل‌گر
- **مدیر سازمان (OrgAdmin):** مدیریت اعضا، مشاهده گزارش کل سازمان، داشبورد مدیریتی
- **مدیرعامل (CEO):** مشاهده داشبورد کلان و تحلیل‌های سطح بالا (داشبورد ویژه مدیرعامل)
- **مدیر ارزیابی (AssessmentManager):** ساخت/ویرایش آزمون، سوال، بانک سوال، تخصیص سوال به نقش پاسخ‌دهنده، مدیریت بانک سوال و آزمون‌های سازمان، داشبورد ویژه ارزیابی

---

## 1.1 داشبورد نقش‌محور (Role-based Dashboard)

- هر نقش کاربری باید داشبورد مخصوص به خود داشته باشد (فرمت داده و ویجت‌ها متفاوت).
- ساختار داده داشبورد باید قابل تنظیم و توسعه باشد (مثلاً JSON با لیست ویجت‌ها و داده هر ویجت).
- فرمت داده‌های داشبورد باید با نیازهای فرانت هماهنگ باشد (نمونه فرمت را از پیاده‌سازی فعلی فرانت می‌توان دید).

### نمونه ساختار داده داشبورد (پیشنهادی)

```json
{
	"widgets": [
		{ "type": "chart", "title": "تحلیل شخصیت", "data": [...] },
		{ "type": "stat", "title": "امتیاز تیمی", "value": 87 }
	]
}
```

---

## 1.2 فرمت آواتار کاربران

- فرمت آواتار باید با پیاده‌سازی فرانت (کامپوننت Avatar) سازگار باشد.
- هر کاربر باید فیلد avatar (آدرس عکس) و fallback (مثلاً حروف اول نام) داشته باشد.
- ساختار پیشنهادی:
  - `avatar: string | null` (آدرس عکس)
  - اگر null بود، در فرانت fallback با حروف اول نام نمایش داده شود (مطابق AvatarFallback)
- نمونه پیاده‌سازی در فایل `src/components/ui/avatar.tsx` موجود است.

---

## 2. ساختار داده و مدل‌ها (پیشنهادی)

### سازمان و عضویت

- **Organization**: اطلاعات سازمان
- **OrgMembership**: عضویت کاربر در سازمان با نقش
- **User**: اطلاعات فردی

### دوره و مهمانان

- **Session/Batch**: هر دوره ارزیابی (مثلاً ۲ هفته)
- **SessionMember**: عضویت فرد در یک دوره خاص

### آزمون و سوالات

- **Assessment**: آزمون (می‌تواند عمومی یا اختصاصی سازمان/دوره باشد)
- **QuestionBank**: بانک سوال (عمومی یا اختصاصی)
- **Question**: سوال (متعلق به بانک، با نوع پاسخ‌دهنده)
- **Option**: گزینه‌های سوال (در صورت نیاز)
- **AssessmentQuestion**: اتصال آزمون به سوالات (با ترتیب و تنظیمات)

### پاسخ و ارزیابی

- **Answer**: پاسخ به سوال (توسط عضو یا تسهیل‌گر)
- **AnswerSession**: گروه‌بندی پاسخ‌ها برای یک آزمون/دوره/عضو

### تحلیل و گزارش

- **AnalysisResult**: خروجی تحلیل (آماری/AI) برای هر فرد/دوره/سازمان
- **DashboardConfig**: تنظیمات داشبورد و ویجت‌ها برای هر نقش

---

## 3. سناریوهای کلیدی

- هر سازمان می‌تواند آزمون اختصاصی یا از بانک سوال عمومی استفاده کند.
- مدیر ارزیابی می‌تواند بانک سوال بسازد، سوالات را به آزمون‌ها تخصیص دهد و تعیین کند هر سوال برای چه نقشی است (عضو/تسهیل‌گر).
- اعضا و تسهیل‌گرها پاسخ‌ها را ثبت می‌کنند؛ داده‌ها ذخیره و برای تحلیل آماده می‌شود.
- تحلیل (آماری/AI) داده‌ها را به فرمت مورد نیاز نمودارها و داشبوردها برمی‌گرداند.
- هر نقش فقط داده‌های مجاز خود را می‌بیند (دسترسی دقیق).

---

## 4. تحلیل و هوش مصنوعی

- داده‌های خام به سرویس تحلیل (AI یا الگوریتم آماری) ارسال می‌شود.
- خروجی دقیقاً در فرمت مورد نیاز فرانت (مثلاً JSON برای نمودار) برمی‌گردد.
- امکان توسعه تحلیل‌های جدید و اتصال به مدل‌های LLM یا سرویس‌های Python وجود دارد.

---

## 5. قابلیت توسعه و استانداردها

- مدل داده طوری طراحی شود که افزودن آزمون/سوال/نقش/تحلیل جدید بدون تغییر اساسی ممکن باشد.
- بانک سوال و آزمون‌ها قابل reuse و ایمپورت/اکسپورت باشند.
- امنیت و حریم خصوصی داده‌ها (دسترسی بر اساس نقش و سازمان) رعایت شود.
- API و مدل داده با Prisma و Nest/Next و قابل استفاده در فرانت React/Next.js

---

## 6. پیشنهادهای فنی

- **Backend:** Prisma + PostgreSQL + NestJS/Next.js API
- **Frontend:** Next.js + React Hook Form + shadcn/ui + TanStack Query
- **AI/تحلیل:** سرویس جداگانه (Python/Node) یا LLM API
- **DevOps:** Docker, Vercel/Railway, CI/CD

---

## 7. نمونه مدل داده (خلاصه)

```prisma
model Organization { ... }
model User { ... }
model OrgMembership { ... }
model Session { ... }
model Assessment { ... }
model QuestionBank { ... }
model Question { ... }
model Option { ... }
model AssessmentQuestion { ... }
model Answer { ... }
model AnalysisResult { ... }
```

---

## 8. نکات کلیدی برای مدل هوش مصنوعی

- همه روابط و نقش‌ها باید قابل استخراج و توضیح باشند.
- هر آزمون و سوال می‌تواند عمومی یا اختصاصی باشد.
- تحلیل باید خروجی کاملاً ساختارمند و قابل تزریق به نمودارها تولید کند.
- بانک سوال و آزمون‌ها باید قابل reuse و مدیریت توسط مدیر ارزیابی باشند.

---

## 9. جمع‌بندی

این معماری و نیازسنجی، پایه‌ای بسیار استاندارد و قابل توسعه برای یک پلتفرم ارزیابی سازمانی مدرن است که هم برای توسعه‌دهنده و هم برای مدیران سازمان و کاربران نهایی تجربه‌ای حرفه‌ای و منعطف فراهم می‌کند.
